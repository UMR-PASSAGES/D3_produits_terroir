// code javascript du jeu clic balles
$(function() {
	init();
});

function init() {
	
	// STRUCTURES
	
	// titre
	var titre = "<p>Cadet de Gassicourt : salé, sucré ou autre</p>";
	document.getElementById("titre").innerHTML = titre;
	// carte
	//var carte = "<p>future carte</p>";
	//document.getElementById("carte").innerHTML = carte;
	// liste
	var listeCat2 = '<select id="listeCat2" name="listeCat2"/>';
	document.getElementById("liste").innerHTML = listeCat2;
	// pied de page
	var footer = "<p>TERESMA - carte test</p>";
	document.getElementById("footer").innerHTML = footer;

	// DONNEES
	// liste catégories : id, libellé, id colonne commune, id couleur
	listeCat = new Array();
	listeCat[0] = [0,'salé',2,0];
	listeCat[1] = [1,'sucré',3,1];
	listeCat[2] = [2,'autre',4,2];
	
	// liste couleurs : id, html
	listeCouleurs = new Array();
	listeCouleurs[0] = [0, '#66c2a5'];
	listeCouleurs[1] = [1, '#fc8d62'];
	listeCouleurs[2] = [2, '#8da0cb'];

	
	// VARIABLES
	var width = 500,
    	height = 500;
    svg = d3.select("#carte")
    	.append("svg")
    	.attr("width", width)
    	.attr("height", height);
    projection = d3.geo.conicConformal() // Lambert-93
    	.center([2.454071, 47.279229]) // On centre la carte sur la France
    	.scale(10000)
    	.translate([500, -200]);
 
	path = d3.geo.path()
		.projection(projection);

	g = svg.append("g");
	h = svg.append("h");
	
	// listes
	listeCat2 = document.getElementById('listeCat2');

	
	// GESTIONNAIRES
	listeCat2.addEventListener('change', colorieCarte);
	
	
	// LANCEMENT
	remplissageListe();
	afficheCarte();

	
}

function remplissageListe() {
	html = '<select id="listeCat2" name="listeCat2">';
	html += '<option value="rien">choisissez une valeur...</option>';
	for (i=0; i<listeCat.length; i++) {
		html += '<option value="' + listeCat[i][1] + '">' +  listeCat[i][1] + '</option>';
	}
	html += '</select>';
	listeCat2.innerHTML = html;
}

function afficheCarte() {

	d3.json("json/communes_Gassicourt_wgs84.json", function(communes) {
				g.append("g")
					.selectAll("path")
					.data(communes.features)
					.enter()
					.append("path")
					.attr("d", path)
					.style("fill", "red");
					
				g.append("path")
					.data(depts.features)
					.attr("d", path)
					.style("fill", "none")
					.style("stroke", "black");
					
			});	
}

function colorieCarte() {
	valListeCat2 = listeCat2.value;
	console.log('valListeCat2 : ' + valListeCat2);	
}
	
